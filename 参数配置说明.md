# 交易策略参数配置说明

本文档详细介绍 `config/settings.py` 中的所有配置参数及其含义。

---

## 目录

1. [市场状态识别配置 (MarketStateConfig)](#1-市场状态识别配置-marketstateconfig)
2. [趋势分析配置 (TrendConfig)](#2-趋势分析配置-trendconfig)
3. [入场信号配置 (SignalConfig)](#3-入场信号配置-signalconfig)
4. [成交量分析配置 (VolumeConfig)](#4-成交量分析配置-volumeconfig)
5. [仓位管理配置 (PositionConfig)](#5-仓位管理配置-positionconfig)
6. [止损止盈配置 (StopLossConfig)](#6-止损止盈配置-stoplossconfig)
7. [风险控制配置 (RiskControlConfig)](#7-风险控制配置-riskcontrolconfig)
8. [回测配置 (BacktestConfig)](#8-回测配置-backtestconfig)
9. [主策略配置 (StrategyConfig)](#9-主策略配置-strategyconfig)

---

## 1. 市场状态识别配置 (MarketStateConfig)

市场状态识别用于判断当前市场是处于**趋势行情**还是**震荡行情**，以便采用不同的交易策略。

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `adx_period` | int | 14 | ADX（平均趋向指数）的计算周期。ADX 用于衡量趋势的强度，周期越长越平滑但反应越慢 |
| `trend_threshold` | float | 25.0 | 趋势市场阈值。当 ADX > 25 时，判定为趋势行情，适合顺势交易 |
| `ranging_threshold` | float | 20.0 | 震荡市场阈值。当 ADX < 20 时，判定为震荡行情，适合区间交易或观望 |
| `atr_period` | int | 14 | ATR（真实波幅均值）的计算周期。ATR 用于衡量市场波动性，是计算止损和仓位的重要指标 |

**使用说明：**
- ADX 介于 20-25 之间时为过渡区域，可以适当降低仓位
- ATR 越大表示市场波动越剧烈，需要更宽的止损空间

---

## 2. 趋势分析配置 (TrendConfig)

使用三条不同周期的 EMA（指数移动平均线）来分析市场趋势。

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `ema_fast` | int | 10 | 快速 EMA 周期。反映短期市场情绪，用于捕捉短期价格变化 |
| `ema_mid` | int | 30 | 中期 EMA 周期。反映中期趋势方向，是主要的趋势参考线 |
| `ema_slow` | int | 60 | 慢速 EMA 周期。反映长期趋势，用于判断大方向 |

**趋势判断逻辑：**
- **多头排列**：EMA_fast > EMA_mid > EMA_slow → 看涨
- **空头排列**：EMA_fast < EMA_mid < EMA_slow → 看跌
- **交叉缠绕**：无明显排列 → 震荡

---

## 3. 入场信号配置 (SignalConfig)

定义入场信号的各项参数，包括 MACD、RSI 指标及入场阈值。

### MACD 参数

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `macd_fast` | int | 12 | MACD 快线 EMA 周期 |
| `macd_slow` | int | 26 | MACD 慢线 EMA 周期 |
| `macd_signal` | int | 9 | MACD 信号线（DEA）周期 |

**MACD 信号说明：**
- MACD = EMA(12) - EMA(26)
- Signal = EMA(MACD, 9)
- 金叉（MACD 上穿 Signal）→ 做多信号
- 死叉（MACD 下穿 Signal）→ 做空信号

### RSI 参数

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `rsi_period` | int | 14 | RSI（相对强弱指数）计算周期 |
| `rsi_oversold` | float | 35.0 | 超卖阈值。RSI < 35 表示市场可能超卖，有反弹机会 |
| `rsi_overbought` | float | 65.0 | 超买阈值。RSI > 65 表示市场可能超买，有回调风险 |

**注意：** 相比传统的 30/70 阈值，这里使用 35/65 更为保守，减少假信号。

### 入场阈值

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `long_threshold` | float | 5.0 | 做多阈值。综合评分 ≥ 5 时触发做多信号 |
| `short_threshold` | float | -5.0 | 做空阈值。综合评分 ≤ -5 时触发做空信号 |

**评分系统说明：**
策略采用多维度评分系统，综合趋势、动量、成交量等因素给出总分，只有达到阈值才会触发交易信号。

---

## 4. 成交量分析配置 (VolumeConfig)

成交量是价格变动的"燃料"，用于确认价格突破的有效性。

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `volume_ma_period` | int | 20 | 成交量移动平均周期。用于计算平均成交量基准 |
| `volume_surge_ratio` | float | 1.5 | 放量比率。当前成交量 > 1.5 倍均量时判定为放量，突破更可信 |
| `volume_shrink_ratio` | float | 0.7 | 缩量比率。当前成交量 < 0.7 倍均量时判定为缩量，谨慎追涨 |

**成交量确认原则：**
- 价格上涨 + 放量 → 强势上涨，可跟进
- 价格上涨 + 缩量 → 上涨乏力，谨慎
- 价格下跌 + 放量 → 恐慌抛售，风险大
- 价格下跌 + 缩量 → 正常回调，可能企稳

---

## 5. 仓位管理配置 (PositionConfig)

科学的仓位管理是风险控制的核心。

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `risk_per_trade` | float | 0.02 | 单笔交易风险。每笔交易最大亏损不超过总资金的 2% |
| `max_position_pct` | float | 0.30 | 单只股票最大仓位。单一标的不超过总资金的 30%，分散风险 |

### 金字塔加仓参数

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `initial_position_pct` | float | 0.50 | 初始仓位比例。首次建仓使用计划仓位的 50% |
| `first_add_pct` | float | 0.30 | 第一次加仓比例。盈利 1 个 ATR 后加仓 30% |
| `second_add_pct` | float | 0.20 | 第二次加仓比例。盈利 2 个 ATR 后再加仓 20% |

**金字塔加仓策略说明：**
```
初始建仓：50% → 盈利1ATR后：+30% → 盈利2ATR后：+20%
最终仓位：50% + 30% + 20% = 100% 计划仓位
```
这种策略的好处是：在趋势确认后逐步加仓，降低初始风险。

---

## 6. 止损止盈配置 (StopLossConfig)

完善的止损止盈机制是保护利润、控制亏损的关键。

### 止损参数

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `initial_stop_atr_mult` | float | 2.0 | 初始止损倍数。止损位 = 入场价 ± 2倍ATR |
| `breakeven_trigger_atr` | float | 1.5 | 保本止损触发点。盈利达到 1.5 倍 ATR 后，将止损移至成本价 |
| `trailing_stop_atr_mult` | float | 2.0 | 移动止损倍数。价格新高后，止损跟随 = 最高价 - 2倍ATR |

### 止盈参数

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `first_target_atr` | float | 2.0 | 第一止盈目标。盈利达到 2 倍 ATR 时触发 |
| `second_target_atr` | float | 4.0 | 第二止盈目标。盈利达到 4 倍 ATR 时触发 |
| `first_tp_portion` | float | 0.33 | 第一目标止盈比例。到达第一目标时平仓 1/3 |
| `second_tp_portion` | float | 0.33 | 第二目标止盈比例。到达第二目标时再平仓 1/3 |

**分批止盈策略说明：**
```
盈利 2ATR → 平仓 33%（锁定部分利润）
盈利 4ATR → 再平仓 33%（继续锁定）
剩余 34% → 使用移动止损，让利润奔跑
```

---

## 7. 风险控制配置 (RiskControlConfig)

整体风险控制参数，防止重大亏损。

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `max_drawdown` | float | 0.15 | 最大回撤限制。账户回撤超过 15% 时暂停交易，等待复盘 |
| `max_daily_loss` | float | 0.05 | 单日最大亏损。当日亏损超过 5% 时停止当天交易 |
| `max_open_positions` | int | 5 | 最大持仓数量。同时持有的标的不超过 5 个，避免过度分散 |

**风控原则：**
- 单笔风险 2% × 5 个仓位 = 最大同时风险 10%
- 日内止损 5% 防止连续错误
- 最大回撤 15% 作为强制冷静期触发点

---

## 8. 回测配置 (BacktestConfig)

回测系统的基础参数设置。

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `initial_capital` | float | 100000.0 | 初始资金。回测起始资金，单位：人民币(CNY) |
| `commission_rate` | float | 0.0003 | 佣金费率。买卖双向收取，0.03%（万三） |
| `stamp_duty` | float | 0.001 | 印花税。仅卖出时收取，0.1%（千一） |
| `slippage` | float | 0.001 | 滑点。模拟实际成交价与预期价的偏差，0.1% |
| `use_gpu` | bool | True | GPU 加速。启用 CUDA 加速回测计算（需要 NVIDIA 显卡） |

**交易成本计算示例：**
```
买入成本 = 成交金额 × 0.03%（佣金）
卖出成本 = 成交金额 × 0.03%（佣金）+ 成交金额 × 0.1%（印花税）
单次往返成本 ≈ 0.16%
```

---

## 9. 主策略配置 (StrategyConfig)

整合所有子配置的主配置类。

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `market_state` | MarketStateConfig | - | 市场状态识别配置 |
| `trend` | TrendConfig | - | 趋势分析配置 |
| `signal` | SignalConfig | - | 入场信号配置 |
| `volume` | VolumeConfig | - | 成交量分析配置 |
| `position` | PositionConfig | - | 仓位管理配置 |
| `stop_loss` | StopLossConfig | - | 止损止盈配置 |
| `risk_control` | RiskControlConfig | - | 风险控制配置 |
| `backtest` | BacktestConfig | - | 回测配置 |
| `trading_timeframe` | str | "1h" | 主交易周期。主要交易信号的时间框架（1小时线） |
| `higher_timeframe` | str | "4h" | 高级别周期。用于趋势确认的更大时间框架（4小时线） |

**多周期分析说明：**
- 使用 4h 线判断大趋势方向
- 使用 1h 线寻找具体入场点
- 大周期定方向，小周期找机会

---

## 参数调优建议

### 保守型设置（适合新手）
```python
risk_per_trade: 0.01      # 降低单笔风险到 1%
max_position_pct: 0.20    # 单股最大 20%
long_threshold: 6.0       # 提高入场门槛
rsi_oversold: 30.0        # 更严格的超卖判断
```

### 激进型设置（适合经验丰富者）
```python
risk_per_trade: 0.03      # 单笔风险 3%
max_position_pct: 0.40    # 单股最大 40%
long_threshold: 4.0       # 降低入场门槛
initial_position_pct: 0.70 # 首次建仓 70%
```

### 震荡市设置
```python
trend_threshold: 30.0     # 提高趋势判断门槛
rsi_oversold: 30.0        # 标准超卖
rsi_overbought: 70.0      # 标准超买
trailing_stop_atr_mult: 1.5 # 更紧的移动止损
```

---

## 使用方法

```python
from config.settings import get_config, set_config, StrategyConfig

# 获取默认配置
config = get_config()

# 修改特定参数
config.signal.rsi_oversold = 30.0
config.position.risk_per_trade = 0.015

# 或创建全新配置
new_config = StrategyConfig()
new_config.backtest.initial_capital = 200000.0
set_config(new_config)
```

---

## 附录：指标公式参考

### ADX（平均趋向指数）
衡量趋势强度，不判断方向。取值 0-100，通常：
- ADX < 20：弱趋势或震荡
- 20 < ADX < 40：趋势形成中
- ADX > 40：强趋势

### ATR（真实波幅均值）
```
TR = max(High-Low, |High-PrevClose|, |Low-PrevClose|)
ATR = SMA(TR, period)
```

### EMA（指数移动平均）
```
EMA(t) = Price(t) × k + EMA(t-1) × (1-k)
k = 2 / (period + 1)
```

### RSI（相对强弱指数）
```
RSI = 100 - 100 / (1 + RS)
RS = 平均上涨幅度 / 平均下跌幅度
```

### MACD
```
MACD = EMA(12) - EMA(26)
Signal = EMA(MACD, 9)
Histogram = MACD - Signal
```

---

*文档生成时间：2026-01-12*
